<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โปรแกรมวางแผนการท่องเที่ยวเชียงใหม่</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css?family=Prompt:400,600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3172/3172555.png"/>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.2em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 16px;
        }
        
        input, select, datalist {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            font-family: 'Prompt', sans-serif;
            transition: all 0.3s ease;
            background: white;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-group label {
            display: flex;
            align-items: center;
            font-weight: 500;
            margin-bottom: 0;
            cursor: pointer;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .checkbox-group label:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            accent-color: #667eea;
        }
        
        .checkbox-group input[type="checkbox"]:checked + span {
            color: #667eea;
            font-weight: 600;
        }
        
        .traveler-block, .day-block {
            background: linear-gradient(145deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .day-block > div {
            margin-bottom: 15px;
        }
        
        .day-block > div:last-child {
            margin-bottom: 0;
        }
        
        .traveler-subtype {
            margin-top: 12px;
        }
        
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Prompt', sans-serif;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
            background: linear-gradient(45deg, #5a6fd8, #6a4c93);
        }
        
        .submit-btn:active {
            transform: translateY(-1px);
        }
        
        .result {
            margin-top: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            border: 1px solid #e9ecef;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-msg {
            text-align: center;
            color: #666;
            font-size: 18px;
            font-weight: 500;
        }
        
        .success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid #c3e6cb;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .plan-day {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }
        
        .plan-day h3 {
            color: #667eea;
            margin-bottom: 18px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 8px;
        }
        
        .plan-day .weather-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #2196f3;
            font-weight: 500;
        }
        
        .plan-day ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .plan-day li {
            background: linear-gradient(145deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 16px 20px;
            margin-bottom: 12px;
            border-radius: 12px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .plan-day li:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .place-name {
            font-weight: 600;
            font-size: 18px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .place-details {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }
        
        .maps-link {
            margin-top: 20px;
            text-align: center;
        }
        
        .maps-link a {
            display: inline-block;
            padding: 12px 24px;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }
        
        .maps-link a:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(40, 167, 69, 0.4);
            background: linear-gradient(45deg, #218838, #1ea97c);
        }
        
        .plan-summary {
            background: linear-gradient(135deg, #e7f3ff 0%, #bbdefb 100%);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #b3d7ff;
            margin-top: 25px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .plan-summary h3 {
            color: #1976d2;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .plan-summary p {
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 500;
        }
        
        .error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid #f5c6cb;
            font-size: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .no-places {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: 500;
            border: 1px solid #ffeaa7;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: flex-end; margin-bottom: 10px;">
            <label for="langSelect" style="margin-right: 8px; font-weight: 600;">Language:</label>
            <select id="langSelect" style="padding: 6px 12px; border-radius: 8px; font-size: 15px;">
                <option value="th">ไทย</option>
                <option value="en">English</option>
            </select>
        </div>
        <h1 id="mainTitle">โปรแกรมวางแผนการท่องเที่ยวเชียงใหม่</h1>
        <form id="tripForm">
            <div class="section">
                <label id="labelNumTravelers">จำนวนนักท่องเที่ยว:</label>
                <input type="number" id="numTravelers" name="numTravelers" min="1" value="1" required>
            </div>
            <div class="section" id="travelersInput"></div>
            <div class="section">
                <label for="hotel" id="labelHotel">โรงแรมที่พัก:</label>
                <input list="hotels" id="hotel" name="hotel" placeholder="เลือกหรือกรอกชื่อโรงแรม..." required>
                <datalist id="hotels">
                    <option value="โรงแรมเชียงใหม่ฮิลล์">
                    <option value="โรงแรมฟูราม่า เชียงใหม่">
                    <option value="โรงแรมยู นิมมาน เชียงใหม่">
                    <option value="โรงแรมเชียงใหม่ออร์คิด">
                    <option value="โรงแรมโลตัส ปางสวนแก้ว">
                </datalist>
            </div>
            <div class="section">
                <label for="startDate" id="labelStartDate">วันที่เริ่มเที่ยว:</label>
                <input type="date" id="startDate" name="startDate" required>
            </div>
            <div class="section">
                <label for="nDays" id="labelNDays">จำนวนวันที่เที่ยว:</label>
                <input type="number" id="nDays" name="nDays" min="1" value="1" required>
            </div>
            <div class="section" id="daysInput"></div>
            <div class="section">
                <label for="budget" id="labelBudget">งบที่มี (บาท):</label>
                <input type="number" id="budget" name="budget" min="1" required>
            </div>
            <div class="section">
                <label for="categories" id="labelCategories">เลือกประเภทสถานที่:</label>
                <div class="checkbox-group" id="categoriesGroup">
                    <label><input type="checkbox" name="categories" value="ธรรมชาติ"><span id="catNature">ธรรมชาติ</span></label>
                    <label><input type="checkbox" name="categories" value="วัฒนธรรม"><span id="catCulture">วัฒนธรรม</span></label>
                    <label><input type="checkbox" name="categories" value="สร้างสรรค์"><span id="catCreative">สร้างสรรค์</span></label>
                </div>
            </div>
            <button type="submit" class="submit-btn" id="btnSubmit">วางแผนทริป!</button>
        </form>
        <div id="result" class="result" style="display: none;"></div>
    </div>
    
    <script>
        // ข้อความสองภาษา
        const LANG_TEXT = {
            th: {
                mainTitle: "โปรแกรมวางแผนการท่องเที่ยวเชียงใหม่",
                numTravelers: "จำนวนนักท่องเที่ยว:",
                hotel: "โรงแรมที่พัก:",
                startDate: "วันที่เริ่มเที่ยว:",
                nDays: "จำนวนวันที่เที่ยว:",
                budget: "งบที่มี (บาท):",
                categories: "เลือกประเภทสถานที่:",
                catNature: "ธรรมชาติ",
                catCulture: "วัฒนธรรม",
                catCreative: "สร้างสรรค์",
                btnSubmit: "วางแผนทริป!",
                traveler: "นักท่องเที่ยว",
                selectType: "-- เลือกประเภท --",
                thai: "ไทย",
                foreigner: "ต่างประเทศ",
                selectGroup: "-- เลือกกลุ่ม --",
                child: "เด็ก",
                adult: "ผู้ใหญ่",
                senior: "ผู้สูงวัย",
                day: "วันที่",
                startTime: "เวลาเริ่มเที่ยว:",
                maxPlaces: "จำนวนสถานที่สูงสุด:",
                returnTime: "เวลาที่ต้องกลับโรงแรม:",
                notSpecify: "ไม่ต้องการระบุ"
            },
            en: {
                mainTitle: "Chiang Mai Trip Planner",
                numTravelers: "Number of travelers:",
                hotel: "Hotel:",
                startDate: "Start date:",
                nDays: "Number of days:",
                budget: "Budget (THB):",
                categories: "Select place categories:",
                catNature: "Nature",
                catCulture: "Culture",
                catCreative: "Creative",
                btnSubmit: "Plan Trip!",
                traveler: "Traveler",
                selectType: "-- Select type --",
                thai: "Thai",
                foreigner: "Foreigner",
                selectGroup: "-- Select group --",
                child: "Child",
                adult: "Adult",
                senior: "Senior",
                day: "Day",
                startTime: "Start time:",
                maxPlaces: "Max places:",
                returnTime: "Return to hotel time:",
                notSpecify: "Not specified"
            }
        };

        let currentLang = 'th';

        function setLanguage(lang) {
            currentLang = lang;
            const t = LANG_TEXT[lang];
                document.getElementById('mainTitle').textContent = t.mainTitle;
                document.getElementById('labelNumTravelers').textContent = t.numTravelers;
                document.getElementById('labelHotel').textContent = t.hotel;
                document.getElementById('hotel').placeholder = (lang === 'en') ? 'Select or enter hotel name...' : 'เลือกหรือกรอกชื่อโรงแรม...';
                document.getElementById('labelStartDate').textContent = t.startDate;
                document.getElementById('labelNDays').textContent = t.nDays;
                document.getElementById('labelBudget').textContent = t.budget;
                document.getElementById('labelCategories').textContent = t.categories;
                document.getElementById('catNature').textContent = t.catNature;
                document.getElementById('catCulture').textContent = t.catCulture;
                document.getElementById('catCreative').textContent = t.catCreative;
                document.getElementById('btnSubmit').textContent = t.btnSubmit;
        }

        document.getElementById('langSelect').addEventListener('change', function() {
            setLanguage(this.value);
        });
        // Dynamic traveler input
        function renderTravelersInput() {
            let n = parseInt(document.getElementById("numTravelers").value) || 1;
            let t = LANG_TEXT[currentLang];
            let html = '';
            for(let i=1;i<=n;i++) {
                html += `
                <div class="traveler-block">
                    <label>${t.traveler} #${i}:</label>
                    <select name="travelerType${i}" class="traveler-type" required>
                        <option value="">${t.selectType}</option>
                        <option value="ไทย">${t.thai}</option>
                        <option value="ต่างประเทศ">${t.foreigner}</option>
                    </select>
                    <select name="travelerSubtype${i}" class="traveler-subtype" style="display:none;">
                        <option value="">${t.selectGroup}</option>
                        <option value="เด็ก">${t.child}</option>
                        <option value="ผู้ใหญ่">${t.adult}</option>
                        <option value="ผู้สูงวัย">${t.senior}</option>
                    </select>
                </div>`;
            }
            document.getElementById("travelersInput").innerHTML = html;
            // show/hide subtype
            document.querySelectorAll('.traveler-type').forEach((sel, idx) => {
                sel.addEventListener('change', function() {
                    let subtypeSel = document.getElementsByName(`travelerSubtype${idx+1}`)[0];
                    if (subtypeSel) {
                        // แสดงกลุ่มทั้งไทยและต่างประเทศ
                        if (this.value === "ไทย" || this.value === "ต่างประเทศ") {
                            subtypeSel.style.display = "inline-block";
                        } else {
                            subtypeSel.style.display = "none";
                            subtypeSel.value = "";
                        }
                    }
                });
            });
            // ...existing code...
        }
        
        document.getElementById("numTravelers").addEventListener("input", renderTravelersInput);

        // Dynamic day input
        function renderDaysInput() {
            let n = parseInt(document.getElementById("nDays").value) || 1;
            let t = LANG_TEXT[currentLang];
            let html = '';
            for(let i=1;i<=n;i++) {
                html += `
                  <div class="day-block">
                    <div>
                        <label>${t.day} ${i} | ${t.startTime}</label>
                        <input type="time" name="startTime${i}" value="08:00" required>
                    </div>
                    <div>
                        <label>${t.maxPlaces}</label>
                        <input type="number" name="maxPlaces${i}" min="1" max="10" value="3" required>
                    </div>
                    <div>
                        <label>${t.returnTime}</label>
                        <select name="returnTime${i}">
                            <option value="ไม่ต้องการระบุ">${t.notSpecify}</option>
                            <option value="16:00">16:00</option>
                            <option value="17:00">17:00</option>
                            <option value="18:00">18:00</option>
                            <option value="19:00">19:00</option>
                            <option value="20:00">20:00</option>
                            <option value="21:00">21:00</option>
                        </select>
                    </div>
                  </div>
                `;
            }
            document.getElementById("daysInput").innerHTML = html;
        }
        
        document.getElementById("nDays").addEventListener("input", renderDaysInput);

        window.onload = function() { 
            renderDaysInput(); 
            renderTravelersInput(); 
            // Set default date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById("startDate").value = tomorrow.toISOString().split('T')[0];
        };

        // Handle form submit (call backend)
        document.getElementById("tripForm").onsubmit = async function(e){
            e.preventDefault();
            const form = e.target;
            let nDays = parseInt(form.nDays.value);
            let categories = [];
            form.querySelectorAll('[name="categories"]:checked').forEach(cb => categories.push(cb.value));
            
            if (categories.length === 0) {
                alert('กรุณาเลือกประเภทสถานที่อย่างน้อย 1 ประเภท');
                return;
            }
            
            let startTimes = [];
            let maxPlaces = [];
            let returnTimes = [];
            
            for (let i = 1; i <= nDays; i++) {
                const startTimeElement = form[`startTime${i}`];
                const maxPlacesElement = form[`maxPlaces${i}`];
                const returnTimeElement = form[`returnTime${i}`];
                
                if (!startTimeElement || !maxPlacesElement || !returnTimeElement) {
                    alert(`ข้อมูลวันที่ ${i} ไม่ครบถ้วน`);
                    return;
                }
                
                startTimes.push(startTimeElement.value);
                maxPlaces.push(parseInt(maxPlacesElement.value));
                returnTimes.push(returnTimeElement.value);
            }
            
            // ดึงนักท่องเที่ยว
            let numTravelers = parseInt(form.numTravelers.value);
            let travelers = [];
            for(let i=1;i<=numTravelers;i++) {
                const ttypeElement = form[`travelerType${i}`];
                const tsubtypeElement = form[`travelerSubtype${i}`];
                
                if (!ttypeElement || !ttypeElement.value) {
                    alert(`กรุณาเลือกประเภทของนักท่องเที่ยว #${i}`);
                    return;
                }
                
                let ttype = ttypeElement.value;
                let tsubtype = tsubtypeElement ? tsubtypeElement.value : null;
                
                if(ttype === "ไทย") {
                    if (!tsubtype) {
                        alert(`กรุณาเลือกกลุ่มของนักท่องเที่ยวไทย #${i}`);
                        return;
                    }
                    travelers.push({type: ttype, subtype: tsubtype});
                } else {
                    travelers.push({type: ttype});
                }
            }
            
            const data = {
              travelers: travelers,
              hotel: form.hotel.value,
              startDate: form.startDate.value,
              nDays: nDays,
              startTimes: startTimes,
              maxPlaces: maxPlaces,
              returnTimes: returnTimes,
              budget: parseInt(form.budget.value),
              categories: categories
            };
            
                        console.log('Sending data:', data); // Debug log
                        document.getElementById("result").style.display = "block";
                        document.getElementById("result").innerHTML = `<div class="loader"></div><div class="loading-msg">กำลังวางแผนทริปและดึงข้อมูลพยากรณ์อากาศ...</div>`;
                        try {
                            const resp = await fetch("http://localhost:5000/plan", {
                                method: "POST",
                                headers: {"Content-Type": "application/json"},
                                body: JSON.stringify(data)
                            });
                            if (!resp.ok) {
                                throw new Error(`HTTP error! status: ${resp.status}`);
                            }
                            const result = await resp.json();
                            console.log('Received result:', result); // Debug log
                            if (result.error) {
                                document.getElementById("result").innerHTML = `<div class="error">เกิดข้อผิดพลาด: ${result.error}</div>`;
                                return;
                            }
                            let html = `<div class="success">✅ วางแผนทริปสำเร็จ</div>`;
                            const inputHotelName = document.getElementById('hotel').value;
                            let inputHotelLocation = '';
                            if (result.days[0] && result.days[0].places && result.days[0].places.length > 0) {
                                inputHotelLocation = result.days[0].places[0].location;
                            }
                            result.days.forEach((day, i) => {
                                let weatherText = day.weather;
                                if (!weatherText) {
                                    weatherText = currentLang === 'en' ? 'Unable to fetch data' : 'ไม่สามารถดึงข้อมูลได้';
                                }
                                html += `<div class="plan-day">
                                    <h3>${LANG_TEXT[currentLang].day} ${i+1} (${day.date})</h3>
                                    <div class="weather-info">
                                        <strong>${LANG_TEXT[currentLang].weather}</strong> ${weatherText}
                                    </div>`;
                                if (day.places && day.places.length > 0) {
                                    html += `<ul>`;
                                    let mapCoords = [];
                                    html += `<li><div class="place-name">🏨 ${inputHotelName} (โรงแรม)</div></li>`;
                                    if (inputHotelLocation) mapCoords.push(inputHotelLocation);
                                    // แสดงจำนวนสถานที่ตาม input (ไม่รวมโรงแรม)
                                    let showPlaces = day.places.slice(1, day.places.length - 1);
                                    let maxShow = maxPlaces[i] || showPlaces.length;
                                    showPlaces = showPlaces.slice(0, maxShow);
                                    for (let j = 0; j < showPlaces.length; j++) {
                                        const place = showPlaces[j];
                                        const costs = place.costs || [];
                                        const costText = costs.length > 0 ? ` (ค่าใช้จ่าย: ${costs.join(', ')} บาท)` : '';
                                        const weatherText = place.weather ? ` ${place.weather}` : '';
                                        const tempText = (place.temp !== undefined && place.temp !== null && place.temp !== '') ? ` (${place.temp}°C)` : ' (ไม่มีข้อมูลอุณหภูมิ)';
                                        const timeText = place.time ? `${place.time}` : '';
                                        const arriveTime = place.time || '';
                                        const recommendTime = place.recommend_time || 0;
                                        const travelTime = place.travel_time || 20;
                                        let departTime = '';
                                        if (arriveTime && recommendTime) {
                                            const [hours, minutes] = arriveTime.split(':').map(Number);
                                            const totalMinutes = hours * 60 + minutes + recommendTime;
                                            const departHours = Math.floor(totalMinutes / 60);
                                            const departMins = totalMinutes % 60;
                                            departTime = `${departHours.toString().padStart(2, '0')}:${departMins.toString().padStart(2, '0')}`;
                                        }
                                        if (place.location) mapCoords.push(place.location);
                                        html += `<li>
                                            <div class="place-name">${place.name}</div>
                                            <div class="place-details">
                                                ${arriveTime ? `🕐 เวลามาถึง: ${arriveTime} น.` : ''}<br>
                                                ${recommendTime ? `⏱️ เวลาแนะนำในการอยู่: ${recommendTime} นาที` : ''}<br>
                                                ${departTime ? `🚶 เวลาออกจากสถานที่: ${departTime} น.` : ''}<br>
                                                ${travelTime ? `🚗 เวลาเดินทางไปสถานที่ถัดไป: ${travelTime} นาที` : ''}<br>
                                                ⭐ คะแนน: ${place.rating || 'N/A'}/5<br>
                                                💰 ${costText || 'ฟรี'}<br>
                                                🌤️ ${weatherText}${tempText}
                                            </div>
                                        </li>`;
                                    }
                                    html += `<li><div class="place-name">🏨 ${inputHotelName} (โรงแรม)</div></li>`;
                                    if (inputHotelLocation) mapCoords.push(inputHotelLocation);
                                    html += `</ul>`;
                                    if (mapCoords.length > 1) {
                                        const mapsEmbedUrl = `https://www.google.com/maps/embed/v1/directions?key=YOUR_GOOGLE_MAPS_API_KEY&origin=${mapCoords[0]}&destination=${mapCoords[mapCoords.length-1]}&waypoints=${mapCoords.slice(1,-1).join('|')}`;
                                        html += `<div class="maps-embed" style="margin:20px 0;text-align:center;"><iframe width="100%" height="350" frameborder="0" style="border:0" src="${mapsEmbedUrl}" allowfullscreen></iframe></div>`;
                                    }
                                } else {
                                    html += `<div class="no-places">ไม่มีสถานที่ท่องเที่ยวในวันนี้</div>`;
                                }
                                if(day.maps_url) {
                                    html += `<div class="maps-link"><a href="${day.maps_url}" target="_blank">🗺️ ดูเส้นทางบน Google Maps</a></div>`;
                                }
                                html += `</div>`;
                            });
                            const summary = result.summary || {};
                            function formatNumber(x) {
                                if (x === undefined || x === null || isNaN(x)) return "ไม่สามารถคำนวณได้";
                                return Number(x).toFixed(2);
                            }
                            const total_cost = formatNumber(summary.total_cost);
                            const total_distance = formatNumber(summary.total_distance);
                            const avg_sat_score = formatNumber(summary.avg_sat_score);
                            html += `<div class="plan-summary">
                                <h3>สรุปการเดินทาง</h3>
                                <p><strong>รวมค่าใช้จ่าย:</strong> ${total_cost} บาท</p>
                                <p><strong>ระยะทางรวม:</strong> ${total_distance} กม.</p>
                                <p><strong>คะแนนความพึงพอใจรวม:</strong> ${avg_sat_score} / 5.0</p>
                            </div>`;
                            document.getElementById("result").innerHTML = html;
                        } catch (err) {
                            console.error('Error:', err);
                            document.getElementById("result").innerHTML = `<div class="error">เกิดข้อผิดพลาด: ${err.message}<br><br>กรุณาตรวจสอบว่า Backend Server ทำงานอยู่ที่ http://localhost:5000</div>`;
                        }
        }
    </script>
</body>
</html>